<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nose Tracker - Accessibility Typing Tool</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Nose Tracking System</h1>
            <p>Phase 4: Voice Selection & Emotion-Based TTS</p>
        </header>

        <div class="main-grid">
            <!-- Left side: Main content -->
            <div class="main-content">
                <div class="text-display">
                    <label>Your Text:</label>
                    <div id="textOutput" class="text-output"></div>
                </div>

                <div class="keyboard-container">
                    <h3>Virtual Keyboard</h3>
                    <div class="keyboard-wrapper">
                        <div class="keyboard" id="keyboard">
                <!-- Numbers Row -->
                <div class="keyboard-row">
                    <button class="key" data-key="1">1</button>
                    <button class="key" data-key="2">2</button>
                    <button class="key" data-key="3">3</button>
                    <button class="key" data-key="4">4</button>
                    <button class="key" data-key="5">5</button>
                    <button class="key" data-key="6">6</button>
                    <button class="key" data-key="7">7</button>
                    <button class="key" data-key="8">8</button>
                    <button class="key" data-key="9">9</button>
                    <button class="key" data-key="0">0</button>
                </div>
                <!-- Row 1 -->
                <div class="keyboard-row">
                    <button class="key" data-key="q">q</button>
                    <button class="key" data-key="w">w</button>
                    <button class="key" data-key="e">e</button>
                    <button class="key" data-key="r">r</button>
                    <button class="key" data-key="t">t</button>
                    <button class="key" data-key="y">y</button>
                    <button class="key" data-key="u">u</button>
                    <button class="key" data-key="i">i</button>
                    <button class="key" data-key="o">o</button>
                    <button class="key" data-key="p">p</button>
                </div>
                <!-- Row 2 -->
                <div class="keyboard-row">
                    <button class="key" data-key="a">a</button>
                    <button class="key" data-key="s">s</button>
                    <button class="key" data-key="d">d</button>
                    <button class="key" data-key="f">f</button>
                    <button class="key" data-key="g">g</button>
                    <button class="key" data-key="h">h</button>
                    <button class="key" data-key="j">j</button>
                    <button class="key" data-key="k">k</button>
                    <button class="key" data-key="l">l</button>
                </div>
                <!-- Row 3 -->
                <div class="keyboard-row">
                    <button class="key" data-key="z">z</button>
                    <button class="key" data-key="x">x</button>
                    <button class="key" data-key="c">c</button>
                    <button class="key" data-key="v">v</button>
                    <button class="key" data-key="b">b</button>
                    <button class="key" data-key="n">n</button>
                    <button class="key" data-key="m">m</button>
                    <button class="key special-key" data-key="BACKSPACE">‚å´</button>
                </div>
                <!-- Punctuation Row -->
                <div class="keyboard-row">
                    <button class="key" data-key=".">.</button>
                    <button class="key" data-key=",">,</button>
                    <button class="key" data-key="!">!</button>
                    <button class="key" data-key="?">?</button>
                    <button class="key" data-key="'">&#39;</button>
                    <button class="key" data-key='"'>&quot;</button>
                    <button class="key" data-key="-">-</button>
                    <button class="key" data-key=":">:</button>
                    <button class="key" data-key=";">;</button>
                </div>
                <!-- Row 4 - Space and special keys -->
                <div class="keyboard-row">
                    <button class="key special-key" data-key="CLEAR">CLEAR</button>
                    <button class="key space-key" data-key=" ">SPACE</button>
                    <button class="key special-key autocomplete-key" data-key="AUTOCOMPLETE">‚úì</button>
                    <button class="key special-key enter-key" data-key="ENTER">SPEAK</button>
                </div>
            </div>
                        </div>
                        <div class="dwell-info">Hover over a key for 0.5s to select it</div>
                </div>
            </div>

            <!-- Right side: Camera -->
            <div class="camera-sidebar">
                <div class="video-container">
                    <video id="webcam" autoplay playsinline></video>
                    <canvas id="canvas"></canvas>
                </div>

                <div class="controls">
                    <button id="startBtn">Start Camera</button>
                    <button id="stopBtn" disabled>Stop Camera</button>
                </div>

                <div class="info">
                    <div class="status" id="status">Click "Start Camera" to begin</div>
                    <div class="coordinates">
                        <span>X: <span id="coordX">0</span></span>
                        <span>Y: <span id="coordY">0</span></span>
                    </div>
                </div>

                <div class="emotion-indicator">
                    <h4>Detected Emotion</h4>
                    <div class="emotion-display">
                        <span class="emotion-icon" id="emotionIcon">üòê</span>
                        <span class="emotion-label" id="emotionLabel">Neutral</span>
                    </div>
                    <div class="emotion-confidence">
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidenceFill"></div>
                        </div>
                        <span class="confidence-text" id="confidenceText">0%</span>
                    </div>
                </div>

                <div class="voice-selector">
                    <h4>Voice Selection</h4>
                    <div class="voice-search-wrapper">
                        <input type="text" id="voiceSearchInput" class="voice-search-input" placeholder="Search 200,000+ voices..." autocomplete="off">
                        <div id="voiceSearchResults" class="voice-search-results"></div>
                    </div>
                    <div class="voice-selected-display">
                        <div class="selected-voice-info">
                            <strong>Selected:</strong> <span id="selectedVoiceName">Male (Default)</span>
                            <br><small>ID: <span id="selectedVoiceId">7d4e8a6444a442eb819c69981fdb8315</span></small>
                        </div>
                    </div>
                    <div class="voice-quick-select">
                        <button class="quick-voice-btn" data-voice-id="7d4e8a6444a442eb819c69981fdb8315" data-voice-name="Male (American)">üë® Male</button>
                        <button class="quick-voice-btn" data-voice-id="b089032e45db460fb1934ece75a8c51d" data-voice-name="Female">üë© Female</button>
                    </div>
                </div>

                <!-- Voice Cloning Setup -->
                <div class="voice-cloning-section">
                    <h4>Personal Voice</h4>
                    <div id="voiceStatus" class="voice-status">
                        <span id="voiceStatusText">Checking...</span>
                        <button id="clearVoiceBtn" class="clear-voice-btn" style="display: none;">Clear Voice</button>
                    </div>
                    <div id="voiceSetupContainer" class="voice-setup-container">
                        <p class="voice-instructions">Record 30 seconds of your voice or upload an audio file to create a personal voice model.</p>
                        
                        <!-- Toggle between record and upload -->
                        <div class="voice-input-toggle">
                            <button id="recordModeBtn" class="toggle-btn active">Record</button>
                            <button id="uploadModeBtn" class="toggle-btn">Upload File</button>
                        </div>
                        
                        <!-- Recording Mode -->
                        <div id="recordingMode" class="input-mode">
                            <div class="recording-controls">
                                <button id="startRecordingBtn" class="record-btn">Start Recording</button>
                                <button id="stopRecordingBtn" class="record-btn" disabled style="display: none;">Stop Recording</button>
                            </div>
                            <div id="recordingTimer" class="recording-timer" style="display: none;">
                                <span id="timerDisplay">00:00</span> / 00:30
                            </div>
                            <div id="recordingProgress" class="recording-progress" style="display: none;">
                                <div id="progressBar" class="progress-bar"></div>
                            </div>
                        </div>
                        
                        <!-- Upload Mode -->
                        <div id="uploadMode" class="input-mode" style="display: none;">
                            <div class="file-upload-container">
                                <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
                                <label for="audioFileInput" class="file-upload-label">
                                    <span class="upload-icon">üìÅ</span>
                                    <span class="upload-text">Choose Audio File</span>
                                    <span class="upload-hint">(30 seconds recommended)</span>
                                </label>
                                <div id="selectedFileName" class="selected-file-name" style="display: none;"></div>
                                <button id="uploadFileBtn" class="upload-file-btn" disabled>Upload & Create Voice</button>
                            </div>
                            
                            <!-- Alternative: Manual Voice ID Entry -->
                            <div class="manual-voice-entry">
                                <p class="manual-entry-hint">Or enter a voice ID if you've created one in Fish Audio dashboard:</p>
                                <div class="voice-id-input-container">
                                    <input type="text" id="manualVoiceIdInput" class="voice-id-input" placeholder="Enter voice ID (reference_id)">
                                    <button id="saveVoiceIdBtn" class="save-voice-id-btn">Save Voice ID</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Upload Status (shared between both modes) -->
                        <div id="uploadStatus" class="upload-status" style="display: none;">
                            <p id="uploadStatusText">Uploading and creating voice model...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Cursor (for full-page accessibility) -->
    <div id="keyboardCursor" class="keyboard-cursor"></div>

    <!-- MediaPipe Face Mesh -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>

    <!-- face-api.js for ML-based emotion detection -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

    <script src="config.js"></script>
    <script src="numberConverter.js"></script>
    <script src="app.js"></script>
</body>
</html>
